// Custom added styles

// Trying to mimic the libadwaita buttons without using gtkalpha for performance reasons
// Some common colored button styles
%btn_normal {
  @if $variant == 'light' {
    @include button(normal, gtkshade($headerbar_color, 1.005), $fg_color);
  }
  @else {
    @include button(normal, $headerbar_color, $fg_color);
  }
}

%btn_hover {
  @if $variant == 'light' {
    @include button(hover, gtkshade($headerbar_color, 0.999), $fg_color);
    &:backdrop {
      @include button(backdrop, gtkshade($bg_color, 0.97), $fg_color);
    }
  }
  @else {
    @include button(hover, $headerbar_color, $fg_color);
    &:backdrop {
      @include button(backdrop, gtkshade($bg_color, 1.19), $fg_color);
    }
  }
}

%btn_active {
  @if $variant == 'light' {
    @include button(active, $headerbar_color, $fg_color);
    &:backdrop {
      @include button(backdrop-active, gtkshade($bg_color, 0.975), $backdrop_fg_color);
    }
  }
  @else {
    @include button(active, gtkshade($headerbar_color, 1.005), $fg_color);
    &:backdrop {
      @include button(backdrop-active, gtkshade($bg_color, 1.17), $backdrop_fg_color);
    }
  }
}

%colored_buttons {
  @extend %btn_normal;
  &:hover { @extend %btn_hover; }
  &:active, &:checked { @extend %btn_active; }

  &:backdrop {
    @include button(backdrop, $bg_color, $fg_color);
  }

  &:disabled {
    @include button(insensitive, $headerbar_color, $fg_color);
    &:backdrop {
      @include button(backdrop-insensitive, $bg_color, $fg_color);
    }
  }

  &.default:not(:backdrop):not(.suggested-action):not(.destructive-action) {
    @extend %btn_normal;
  }

  &.flat:not(:hover):not(:active) { @include button(undecorated); }

  &.suggested-action, &.text-button.suggested-action { @extend %suggested_buttons; }
  &.destructive-action, &.text-button.destructive-action { @extend %destructive_buttons; }
}

%headerbar_buttons {
  // The normal state is set where it's needed. Usually undecorated.
  &:hover {
    @if $variant == 'light' {
      //@include button(normal, gtkmix(white, $headerbar_color, 28%), $fg_color);
      @include button(normal, gtkshade($headerbar_color, 1.025), $fg_color);
    }
    @else {
      @include button(normal, gtkshade($headerbar_color, 0.87), $fg_color);
    }
  }

  &:backdrop:hover {
    @if $variant == 'light' {
      @include button(backdrop, gtkshade($bg_color, 0.99), $backdrop_fg_color);
    }
    @else {
      @include button(backdrop, gtkshade($bg_color, 1.06), $backdrop_fg_color);
    }
    &:checked, &:active {
      @if $variant == 'light' {
        @include button(active, gtkshade($headerbar_color, 1.015), $backdrop_fg_color);
      }
      @else {
        @include button(active, gtkshade($headerbar_color, 0.9), $backdrop_fg_color);
      }
    }
  }

  &:active, &:checked, &:active:hover, &:checked:hover {
    @if $variant == 'light' {
      @include button(hover, gtkshade($headerbar_color, 1.015), $fg_color);
    }
    @else {
      @include button(hover, gtkshade($headerbar_color, 0.9), $fg_color);
    }
    &:backdrop {
      @if $variant == 'light' {
        @include button(active, gtkshade($bg_color, 1.015), $backdrop_fg_color);
      }
      @else {
        @include button(active, gtkshade($bg_color, 0.9), $backdrop_fg_color);
      }
    }
  }

  &.default:not(:backdrop):not(.suggested-action):not(.destructive-action) {
    @include button(normal, $headerbar_color, $fg_color);
  }

  &.flat:not(:hover):not(:active) { @include button(undecorated); }

  &.suggested-action, &.text-button.suggested-action { @extend %suggested_buttons; }
  &.destructive-action, &.text-button.destructive-action { @extend %destructive_buttons; }
}

%suggested_buttons {
  @include button(normal, $suggested_bg_color, white);
  &:hover { @include button(hover, $suggested_bg_color, white); }
  &:active, &:checked { @include button(active, gtkalpha($suggested_bg_color, 0.5), white); }
  &:backdrop, &:backdrop:hover { @include button(backdrop, gtkalpha($suggested_bg_color, 0.5), white); }
  &:disabled { @include button(insensitive, $headerbar_color, $fg_color); }
  &:backdrop:disabled { @include button(backdrop-insensitive, $bg_color, $fg_color); }
}

%destructive_buttons {
  @include button(normal, $destructive_color, white);
  &:hover { @include button(normal, $destructive_color, white); }
  &:active, &:checked { @include button(active, gtkalpha($destructive_color, 0.5), white); }
  &:backdrop, &:backdrop:hover { @include button(backdrop, gtkalpha($destructive_color, 0.5), white); }
  &:disabled { @include button(insensitive, $headerbar_color, $fg_color); }
  &:backdrop:disabled { @include button(backdrop-insensitive, $bg_color, $fg_color); }
}

// headerbar stuff
headerbar, .titlebar {
  button:not(.titlebutton) {
    &, &:backdrop { @include button(undecorated); }
    @extend %headerbar_buttons;
  }

  // Text buttons
  button.text-button:not(.suggested-action):not(.destructive-action):not(:disabled) {
    @extend %colored_buttons;
  }

  // Linked button borders
  .linked.raised button:not(:only-child),
  .linked button:not(:only-child),
  & > .stack-switcher.linked > button:not(:only-child) {
    @extend %linked;
    &, &:hover, &:not(:backdrop), &:not(:disabled) {
      &:not(:first-child) { border-left-color: $border_color; }
      &:not(:last-child) { border-right-color: $border_color; }
    }
    &:first-child { border-left-color: transparent; }
    &:last-child { border-right-color: transparent; }

    // Trick to get a linked right border on checked buttons, and no left border on the next button
    &:first-child:not(:backdrop),
    &:not(:last-child):not(:backdrop) {
      &:checked, &:active {
        box-shadow: inset -1px 0 $border_color;
        + button { border-left-color: transparent; }
      }
    }
  }

  // Linked color fills
  // In libadwaita the linked buttons appear on hover, so it would be better to have ".linked:hover button" instead, but sadly it is not possible.
  .linked.raised button,
  .linked button:not(:only-child),
  & > .stack-switcher.linked > button { @extend %colored_buttons; }

  // hdy viewswitcher buttons (weather, system monitor, etc.)
  viewswitcher button.radio:checked {
    @extend %headerbar_buttons;
  }

  // Selection mode
  &.selection-mode {
    button,
    button.text-button:not(.suggested-action):not(.destructive-action):not(:disabled) { @extend %suggested_buttons; }
  }

  // Entries
  entry {
    min-height: 32px; // Evens out the height for the top and bottom borders which adds 2px

    @extend %btn_normal;
    &:backdrop { @include button(backdrop, $bg_color, $fg_color); }

    &:disabled { @include button(insensitive, $headerbar_color, $insensitive_fg_color); }
    &:disabled:backdrop { @include button(insensitive, $bg_color, $backdrop_insensitive_color); }

    image { // icons inside the entry
      &.left { margin-right: 6px; }
      &.right { margin-left: 6px; }

      // entry icons colors
      color: gtkmix($fg_color, $base_color, 80%);
      &:hover { color: $fg_color; }
      &:active { color: $selected_bg_color; }
      &:backdrop { color: gtkmix($backdrop_fg_color, $backdrop_base_color, 80%); }
    }

    selection { @extend %selected_items; }

    // entry error and warning style
    @each $e_type, $e_color in (error, $error_color),
                               (warning, $warning_color) {
      &.#{$e_type} {
        color: $e_color;
        border-color: entry_focus_border($e_color);

        &:focus { @include entry(focus, $e_color); }

        selection { background-color: $e_color; }
      }
    }

    &.flat {
      &:focus, &:backdrop, &:disabled, &:backdrop:disabled, & {
        min-height: 0;
        padding: 2px;
        background-color: transparent;
        border-color: transparent;
        border-radius: 0;
      }
    }

    &:drop(active) {
      &:focus, & {
        border-color: $drop_target_color;
        box-shadow: inset 0 0 0 1px $drop_target_color;
      }
    }

    progress {
      margin: 2px -6px;
      background-color: transparent;
      background-image: none;
      border-radius: 0;
      border-width: 0 0 2px;
      border-color: $progress_bg_color;
      border-style: solid;
      box-shadow: none;

      &:backdrop { background-color: transparent; }
    }
  }

  .linked entry:not(:first-child) {
    border-left-color: $border_color;
  }
  .linked entry ~ .image-button { @extend %colored_buttons; }

  // disabled switches
  switch:disabled {
    background-color: gtkmix(black, $backdrop_dark_fill, 4%);
    &:backdrop { background-color: $backdrop_dark_fill; }
  }

  // better animation when switching from backdrop
  &:not(:backdrop) { transition: 200ms ease-in; }

  // Balance out the titlebutton margin
  .right {
    margin-left: -4px;
    separator { min-width: 0; }
  }
  .left {
    margin-right: -4px;
    separator { min-width: 0; }
  }
}

// Different button color on brighter elements like lists and popovers
.content list,
list.content,
list.view.frame {
  button, > row:not(:selected):hover button {
    @include button(normal, $base_color, $fg_color);
    &.flat:not(:hover):not(:active) { @include button(undecorated); }
    &:hover { @include button(hover, $base_color, $fg_color); }
    &:active, &:checked { @include button(active, $base_color, $fg_color); }
    &:disabled { @include button(insensitive, $base_color, $fg_color); }
    &:backdrop { @include button(backdrop, $base_color, $fg_color); }
    &:backdrop:disabled { @include button(backdrop-insensitive, $base_color, $fg_color); }

    &.suggested-action { @extend %suggested_buttons; }
    &.destructive-action { @extend %destructive_buttons; }
  }
  entry {
    @include button(normal, $base_color, $fg_color);
    &:disabled { @include button(insensitive, $base_color, $fg_color); }
    &:backdrop { @include button(backdrop, $base_color, $fg_color); }
    &:backdrop:disabled { @include button(backdrop-insensitive, $base_color, $fg_color); }
  }
}

popover.background {
  button {
    @include button(normal, $popover_bg_color, $fg_color);
    &.flat:not(:hover):not(:active) { @include button(undecorated); }
    &:hover { @include button(hover, $popover_bg_color, $fg_color); }
    &:active, &:checked { @include button(active, $popover_bg_color, $fg_color); }
    &:disabled { @include button(insensitive, $popover_bg_color, $fg_color); }
    &:backdrop { @include button(backdrop, $popover_bg_color, $fg_color); }
    &:backdrop:disabled { @include button(backdrop-insensitive, $popover_bg_color, $fg_color); }

    &.suggested-action { @extend %suggested_buttons; }
    &.destructive-action { @extend %destructive_buttons; }
  }
  entry {
    @include button(normal, $popover_bg_color, $fg_color);
    &:disabled { @include button(insensitive, $popover_bg_color, $fg_color); }
    &:backdrop { @include button(backdrop, $popover_bg_color, $fg_color); }
    &:backdrop:disabled { @include button(backdrop-insensitive, $popover_bg_color, $fg_color); }
  }
}

// Even out toggle button padding to make them more square
button.toggle:not(.image-button) {
  padding-left: 8px;
  padding-right: 8px;
}

// Font fixes when button text is bold
.flat.popup:not(.title) {
  font-weight: normal;
}

// Smaller text in statusbars
statusbar {
  font-size: small;
}

// scrolled window list rows
scrolledwindow list {
  &:not(.content) {
    padding: 6px 0;
  }
  row {
    margin: 0 6px;
    border-radius: $button_radius;
  }
  separator.horizontal {
    margin: 6px;
  }
}

// Fix wrong border-radius on hdy spinbutton entries
list.content .horizontal spinbutton entry {
  border-top-left-radius: $button_radius;
  border-bottom-left-radius: $button_radius;
}

// Non "content" lists
list.view.frame {
  border-radius: $card_radius;
  &, &:backdrop { background-color: $card_bg_color; }
}

// Legacy application titlebuttons
.ssd .titlebar {
  border-width: 0;
  padding: 0px 4px;
  min-height: 36px;
  border-bottom: 1px solid $borders_color;
  &:backdrop { border-color: $backdrop_borders_color; }

  &.default-decoration button.titlebutton {
    background-color: $titlebutton_normal;
    min-height: 24px;
    min-width: 24px;
    margin: 0 4px 0 4px;
    padding: 0;
    &:hover { background-color: $titlebutton_normal_hover; }
    &:hover:active, &:active { background-color: $titlebutton_normal_active; }
    &:backdrop { background: $titlebutton_backdrop; }
    &:backdrop:hover { background: $titlebutton_backdrop_hover; }
  }
}

// Tree views
treeview.view:not(:backdrop):not(:selected):hover {
  background-color: $view_hover_color;
}

// Preferences window
// In nautilus preferences there is no padding below the last list
.preferences scrolledwindow > .frame > clamp {
  &.large, &.medium, &.small { padding-bottom: 30px; }
}

// Linked osd buttons, like in totem
.osd .linked > button { border-color: transparent; }

// Toolbars
.primary-toolbar, .toolbar {
  background-color: $bg_color;
  &:backdrop { background-color: $backdrop_bg_color; }
}

// Popover menuitems
popover.background {
  modelbutton.flat {
    padding-left: 16px;
    padding-right: 16px;
  }
}
